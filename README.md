# MSISDN_info

Flask web-приложение, которое обновляет базу данных PostgreSQL с информацией о российских номерах телефонов, а также позволяет производить поиск оператора и региона по введенному в форму на сайте номеру телефона.

## Приложение состоит из трех основных функций:
1) update_data() - функция, которая обновляет базу данных из csv-файлов, которые загружаются с сайта https://opendata.digital.gov.ru/registry/numeric/downloads/. Для этого функция скачивает csv-файлы, вычисляет хеш-сумму каждого файла и сравнивает ее с хеш-суммой, хранящейся в отдельном файле. Если хеш-суммы не совпадают, то функция обновляет базу данных.
2) get_operator_and_region(number) - функция, которая по номеру телефона ищет соответствующую запись в базе данных и возвращает имя оператора и название региона.
3) run_scheduler() - функция, которая устанавливает расписание для обновления данных в базе данных и запускает обновление каждый день в 00:00.

## Проект включает в себя следующие файлы:
1) app.py - главный файл проекта, содержащий функции для парсинга и обновления данных, а также для поиска телефона в базе данных.
2) requirements.txt - файл, содержащий список зависимостей проекта.
Как использовать проект

Для установки зависимостей, необходимо выполнить следующую команду:
```sh
pip install -r requirements.txt
```

В app.py в сегменте:
```sh
conn = psycopg2.connect(
    host="localhost",
    port=5432,
    user="postgres",
    password="1234"
)
```
вписать user и password своего суперпользователя PostgreSQL. Остальное можно не менять.

Тестировалось на Windows 10 с PyCharm 2021.1 (Community Edition).

## План:
Запускаете код, создаются (при отсутствии) необходимые пользователь, схема, БД, таблица. Происходит скачивание csv файлов и заполнение БД информацией из них, поднимается сервер, можно работать (вписывать телефоны и проверять).
Раз в сутки в 00:00 будет предпринята попытка обновить БД, код сверит по md5 обновлялись ли файлы которые мы скачиваем, если какой-то из файлов обновился, то обновится и часть БД содержащая данные из этого файла.

Форма для ввода будет доступна по адресу http://127.0.0.1:5000/, туда необходимо ввести номер телефона в формате 7XXXXXXXXXX, +7XXXXXXXXXX или 8XXXXXXXXXX. При успешном поиске в базе данных будет выведен оператор и регион, к которому относится указанный номер телефона.

## В коде используются следующие библиотеки:
- csv - для работы с csv-файлами;
- hashlib - для вычисления хеш-суммы файлов;
- os - для работы с файловой системой;
- psycopg2 - для работы с PostgreSQL;
- requests - для загрузки файлов с сайта;
- schedule - для установки расписания;
- threading - для многопоточности;
- time - для работы со временем;
- io - для работы с файловыми потоками;
- urllib.parse - для разбора URL-адресов;
- bs4 - для парсинга HTML-страниц.

P.S.: Код не лишён недостатков, многое можно улучшить и оптимизировать, в особенности в работе с БД, это так сказать первое приближение написанное за ограниченное время.
